---
import Layout from "../../layouts/Layout.astro";
import schedule from "./schedule.json";

const dateNow = new Date().toLocaleString("en-US", {
  timeZone: "America/New_York",
  day: "numeric",
  month: "numeric",
});

const secondsToTime = (seconds: string | number) => {
  seconds = Number(seconds);
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const ampm = hours >= 12 ? "pm" : "am";
  const hours12 = hours % 12 || 12;
  const minutesStr = minutes.toString().padStart(2, "0");
  return `${hours12}:${minutesStr} ${ampm}`;
};

type Period = [string, [number, string]];

const scheduleToday =
  dateNow in schedule ? schedule[dateNow as keyof typeof schedule] : null;
---

<Layout title="PHS Web Dev">
  <main class="max-w-screen-lg px-2 mx-auto">
    <section class="sm:mt-16 mt-8">
      <h1 class="sm:text-5xl text-4xl font-bold">PHS Schedule</h1>
    </section>
    <section class="sm:mt-8 mt-4">
      {
        scheduleToday ? (
          <>
            <div class="sm:flex justify-between">
              <h1 class="sm:text-4xl text-3xl font-bold">Today's Schedule</h1>
              <h1 class="sm:text-4xl text-xl text-white/75 ">
                {new Date().toLocaleString("en-US", {
                  timeZone: "America/New_York",
                  weekday: "long",
                  month: "long",
                  day: "numeric",
                })}
              </h1>
            </div>
            <h2 class="text-4xl mt-4">{scheduleToday[0]}</h2>
            <div class="mt-5">
              {Object.entries(scheduleToday[1]).map(
                ([startTime, [endTime, period]]: Period) => (
                  <div class="mt-3 flex justify-between items-center">
                    <h1 class="sm:text-3xl text-2xl font-bold">{period}</h1>
                    <div class="flex sm:gap-2 gap-1">
                      <h1 class="sm:text-3xl text-xl">
                        {secondsToTime(startTime)}
                      </h1>
                      <h1 class="sm:text-3xl text-xl">â†’</h1>
                      <h1 class="sm:text-3xl text-xl">
                        {secondsToTime(endTime)}
                      </h1>
                    </div>
                  </div>
                )
              )}
            </div>
          </>
        ) : (
          <h1 class="text-5xl font-bold">No School Today</h1>
        )
      }
    </section>
  </main>
</Layout>
